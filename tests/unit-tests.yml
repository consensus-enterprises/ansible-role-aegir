---
- name: "'Unit-test' playbook."
  hosts: all

  vars:
    # Dependencies
    mysql_root_password: '123456'

  roles:
    - geerlingguy.mysql

  tasks:

  - name: Include default variables, since we call task includes separately.
    include_vars:
      file: consensus.aegir/defaults/main.yml

  - name: Override HTTP service type.
    # Normally, we'd set this in the `vars` section. However, we do this here
    # because the `include_vars` above will overwrite anything we set in
    # `vars`.
    set_fact:
      aegir_http_service_type: nginx

  - include: unit-tests/dependencies.yml
  - include: unit-tests/user.yml
  - include: unit-tests/drush.yml
  - include: unit-tests/provision.yml
  - include: unit-tests/nginx.yml
  - include: unit-tests/sudo.yml
  - include: unit-tests/makefile.yml
  - include: unit-tests/debconf.yml
  - include: unit-tests/platform.yml
  - include: unit-tests/install.yml
  - include: unit-tests/upgrade.yml
  - include: unit-tests/global.yml
  - include: unit-tests/vault.yml
  - include: unit-tests/custom-drush.yml
  - include: unit-tests/custom-provision.yml
