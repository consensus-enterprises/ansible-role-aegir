---
- name: "'Unit-test' playbook."
  hosts: all

  vars:
    aegir_http_service_type: nginx
    aegir_php_version: 7

  tasks:

  - include_vars:
      file: consensus.aegir/defaults/main.yml

  - include_role:
      name: consensus.aegir
      tasks_from: dependencies.yml

  - name: Check that dependency packages are installed
    shell: "dpkg -l|grep '^ii  {{ item }}'"
    loop: "{{ aegir_dependencies + aegir_dependencies_php7 + aegir_dependencies_nginx_php7 }}"
    ignore_errors: yes # TODO: fix for CI

  - include_role:
      name: consensus.aegir
      tasks_from: git/user.yml

  - name: Check that 'aegir' user exists.
    shell: "getent passwd aegir"

  - name: Check that 'aegir' group exists.
    shell: "getent group aegir"

  - name: Check that 'aegir' home directory exists.
    shell: "[ -d /var/aegir ]"

  - name: Check that 'aegir' Drush directory exists.
    shell: "[ -d /var/aegir/.drush ]"
